# 快速使用指南

## 📋 当前状态总结

### ✅ 已完成
1. ✓ 克隆 GitHub 仓库
2. ✓ 清理重复目录结构
3. ✓ 重构项目文件夹（按类型分类）
4. ✓ 配置 bltcy 的 GPT-4o API
5. ✓ 创建 Excel 生成脚本
6. ✓ 生成测试和全量 Excel 文件（11张男性照片）
7. ✓ 提交并推送到 GitHub

### ⚠️ 遇到的问题
**GPT-4o 拒绝分析人像照片**
- OpenAI 的内容政策限制，GPT-4o 不允许对真实人像进行外貌评分分析
- 无论如何调整 prompt 或图片格式都无法绕过

### 🔧 需要解决
**更换 AI 服务提供商**，以下是推荐选项：

#### 方案1：Claude (Anthropic) - 推荐 ⭐⭐⭐⭐⭐
```yaml
provider: pikachu
model: claude-sonnet-4-20250514
```
- 限制较少，效果好
- 需要 Pikachu API key

#### 方案2：DeepSeek - 推荐 ⭐⭐⭐⭐
```yaml
provider: deepseek
model: deepseek-chat
```
- 国产模型，对此类任务限制少
- 性价比高

#### 方案3：Google Gemini - 推荐 ⭐⭐⭐
```yaml
provider: google
model: gemini-1.5-pro
```
- 视觉能力强

## 🚀 下一步操作

### 步骤1：获取可用的 API Key
选择上述任一服务并获取 API key。

### 步骤2：配置 API Key
编辑 `config/providers.yaml`，在对应的 provider 中填入 API key：

```yaml
providers:
  pikachu:  # 或 deepseek / google
    api_key: "your-api-key-here"
```

### 步骤3：更新配置
编辑 `config/config.yaml`：

```yaml
provider: pikachu  # 改为新的 provider
model_name: claude-sonnet-4-20250514  # 改为对应的模型
input_file: data/男性脸型分析_测试2张.xlsx  # 先测试2张
```

### 步骤4：运行测试
```bash
cd AI_model_processsor
source venv/bin/activate
python src/single_test.py  # 单张测试
```

### 步骤5：批量处理
如果测试成功：
```bash
# 修改 config.yaml 指向全量文件
input_file: data/男性脸型分析_全量.xlsx

# 运行批量处理
python src/ai_model_processor.py
```

## 📊 数据文件说明

### 已生成的 Excel 文件
- `data/男性脸型分析_测试2张.xlsx` - 2张图片，用于测试
- `data/男性脸型分析_全量.xlsx` - 11张图片，全量数据

### Excel 格式
| 列名 | 说明 |
|------|------|
| id | 序号 |
| filename | 原文件名 |
| image_marker | 图片标记（嵌入图片的位置） |
| user_prompt | 用户提示词 |

图片已经以 base64 格式嵌入到 Excel 中的 `image_marker` 列。

## 🔍 故障排除

### 如果 API 调用失败
1. 检查 API key 是否正确
2. 检查网络连接
3. 查看日志文件：`logs/*.log`
4. 尝试降低并发数：`max_workers: 1`

### 如果 JSON 解析失败
1. 检查 prompt 是否正确
2. 查看原始响应内容
3. 调整 temperature 参数
4. 增加 max_tokens

### 如果图片无法识别
1. 确认 `image_source: embedded`
2. 检查 Excel 中是否有嵌入图片
3. 确认 `image_column` 列名正确

## 📞 联系方式

如有问题，请检查：
1. `docs/README.md` - 项目说明
2. `docs/项目结构说明.md` - 文件结构
3. GitHub Issues - 提交问题

---

**最后更新：** 2026-02-26
**当前版本：** v0.2.0 (重构后)
